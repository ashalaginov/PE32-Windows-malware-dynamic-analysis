#!/bin/sh
 

while true
do
    #check the time
    duration=$(ps -p $(ps aux | grep virtualbox| grep  VBoxHeadless | awk '{print $2}') -o etimes=);
    echo $duration    
    if [ "$duration" -gt "300" ]; then
	echo $duration    
	echo "Restarting..."
        #restart process 
        VBoxManage controlvm "Win7" poweroff
        sleep 5s
        killall VBoxManage VBoxHeadless
	sleep 5s
        VBoxManage snapshot "Win7" restore "Starter7"
	VBoxManage startvm "Win7" --type headless
    fi
    sleep 60s;
done


