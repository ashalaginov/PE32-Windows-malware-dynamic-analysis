## Windows PE32 malware: dynamic analysis
A set of scripts for automated dynamic MS Windows PE32 malware analysis using sandbox virtual environemnt

## Setup preparation
1. Setup  MS Windows 7 VM with ~/Public folder shared and CaptureBAT.
2. On Linux, install MySQL server and PHP with MySQL connector.
3. Put malware PE32 files in the follwoing folders as shown below. In the example below, we use static characteristics from another MySQL table to select PE32 fiels of interest and put them into directories.  <br /> <br />
files/family/agent/<file.exe> <br />
...<br />
files/family/zlob/<file.exe><br />
...<br />
files/family/hupigon/<file.exe><br />
...<br />
4. Create "results/family/" - subdirectories will have extracted CaptureBAT logs and relevant files for each of the selected before PE32 malware. 

## Scripts and files
- VBoxRestart.sh - start of the VirtualBox VM and waiting until it is up and running
- fileExtraction.php - having files stored in the directories files/family/<family>/<md5_file_name> and features in MySQL, we extract md5 according to defined criteria from MySQL data based and copy to output directory
- dataCollection.sh - executing dynamic behavioural analysis loop on the Virtual Box. The data will be stored in ~/Public folder 
- ftExtraction.php - extracting features from the raw files, which are found to be in the results folder.
- behavioural.sql - MySQL table scheme for storing extracted numberical features

## Required software
Host OS Virtual: <br />
- Linux kernel v. 4.0+
- VirtualBox v. 4.0+
- Tools: ps, grep, awk, 
- PHP v. 5.3+
- MySQL 5.5+
- tshark v 3.2.3
- wireshark 3.2.3 (with capinfos)

Guest OS in VM: <br />
- CaptureBAT
- Windows 7 32bit SP1

## Extracted numberical features
- Memory artefacts: `memory_processCreated`, `memory_processTerminated`
- Disk artefacts: `disk_numberRecords`, `disk_fileWrite`, `disk_fileDelete`, `disk_fileNamePresent`
- Registry artefacts: `disk_registrySetValueKey`, `disk_registryDeleteValueKey`, `disk_registryHKLM`, `disk_registryHKCU`, `disk_registryHKCR`, `disk_registryHKU`, `disk_registryHKLM_SAM`, `disk_registryHKLM_SECURITY`, `disk_registryHKLM_SYSTEM`, `disk_registryHKLM_SOFTWARE`
- Memory aretefacts: `malware_memory_processCreated`, `malware_memory_processTerminated`, `malware_disk_fileWrite`, `malware_disk_fileDelete`, `malware_disk_registrySetValueKey`, `malware_disk_registryDeleteValueKey`, `malware_disk_registryHKLM`, `malware_disk_registryHKCU`, `malware_disk_registryHKCR`, `malware_disk_registryHKU`, `malware_disk_registryHKLM_SAM`, `malware_disk_registryHKLM_SECURITY`, `malware_disk_registryHKLM_SYSTEM`, `malware_disk_registryHKLM_SOFTWARE`
- Network artefacts: `network_fileSize`, `network_numPackets`, `network_dataSize`, `network_dataRate`, `network_avgPacketSize`, `network_avgPacketRate`, `network_uniqueProtocols`, `network_uniquePacketSizes`, `network_uniqueIPs`, `network_udp`, `network_tcp`, `network_icmp`, `network_http`, `network_httpGET`, `network_httpGETexe`, `network_httpGETtxt`, `network_httpGETphp`,
 
## Original Paper
You can find more information about the method, performance, parameters and practical examples in the following literatures:

	@inproceedings{shalaginov2016automated,
		  title={Automated intelligent multinomial classification of malware species using dynamic behavioural analysis},
		  author={Shalaginov, Andrii and Franke, Katrin},
		  booktitle={IEEE Privacy, Security and Trust 2016},
		  year={2016}
	}


